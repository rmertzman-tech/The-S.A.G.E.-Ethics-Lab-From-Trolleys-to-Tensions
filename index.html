<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.A.G.E. Ethics Lab: Complete Edition</title>
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --accent: #ff6b6b;
            --care: #f59e0b; /* Gold for Care Ethics */
            --bg-light: #f8f9fa;
            --text-dark: #2d3748;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #f0f2f5;
            color: var(--text-dark);
            line-height: 1.6;
            padding-bottom: 80px;
        }

        /* --- HERO --- */
        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .hero h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .hero p { opacity: 0.9; }

        /* --- NAV --- */
        .nav-bar {
            display: flex;
            justify-content: center;
            background: white;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-btn {
            padding: 8px 16px;
            border: none;
            background: none;
            font-weight: 600;
            color: #718096;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-size: 0.9rem;
        }

        .nav-btn.active { color: var(--primary); border-bottom-color: var(--primary); background: #ebf8ff; border-radius: 4px 4px 0 0; }
        .nav-btn:hover { color: var(--secondary); }

        /* --- CONTAINER & SECTIONS --- */
        .container { max-width: 900px; margin: 2rem auto; padding: 0 20px; }
        .section { display: none; animation: fadeIn 0.4s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- CARDS --- */
        .card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-top: 4px solid var(--primary);
        }

        .concept-box {
            background: #eef2ff;
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.95rem;
        }

        /* --- TROLLEY STAGE --- */
        .track-stage {
            position: relative;
            height: 250px;
            background: #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* Dynamic Elements for Trolley */
        .track-line { position: absolute; height: 12px; background: #4a5568; top: 50%; left: 0; width: 100%; transform: translateY(-50%); }
        .track-split { position: absolute; height: 12px; background: #4a5568; top: 50%; left: 30%; width: 70%; transform-origin: left; transform: rotate(20deg); display:none; }
        .track-bridge { position: absolute; top: 20%; left: 40%; width: 100px; height: 120%; background: rgba(0,0,0,0.1); border-left: 5px dashed #4a5568; border-right: 5px dashed #4a5568; display: none; }
        .track-loop { position: absolute; height: 120px; width: 200px; border: 12px solid #4a5568; border-left: none; top: 50%; left: 30%; border-radius: 0 100px 100px 0; transform: translateY(-50%); display:none; }
        
        .trolley-icon { font-size: 3rem; position: absolute; top: 38%; left: 5%; transition: all 1s ease-in-out; z-index: 10; }
        
        .victim-group { position:absolute; top:42%; right:10%; font-size:2rem; }
        .victim-single { position:absolute; top:65%; right:10%; font-size:2rem; display:none; }
        .victim-bridge { position:absolute; top:15%; left:45%; font-size:2.5rem; display:none; z-index:20; }

        /* --- BUTTONS --- */
        .btn-group { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px; justify-content: center; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: transform 0.2s; min-width: 150px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .btn-action { background: var(--primary); color: white; }
        .btn-danger { background: var(--text-dark); color: white; } /* Do Nothing is neutral/dark */
        .btn-care { background: var(--care); color: white; }
        .btn-outline { background: white; border: 2px solid var(--primary); color: var(--primary); }

        /* --- ANALYSIS & TRIANGLE --- */
        .analysis-box { display:none; margin-top:20px; animation: fadeIn 0.5s; }
        .lens-card { background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #ccc; }
        
        .triangle-container {
            display: flex; justify-content: center; align-items: center; margin: 40px 0; position: relative; height: 200px;
        }
        .triangle-point { position: absolute; padding: 8px 15px; border-radius: 20px; font-weight: bold; color: white; font-size: 0.85rem; }
        .tp-kant { top: 0; background: #9c27b0; } 
        .tp-util { bottom: 0; right: 0; background: #2196f3; }
        .tp-care { bottom: 0; left: 0; background: var(--care); }
        .center-solution { position: absolute; top: 40%; background: white; padding: 10px; border: 2px solid #2d3748; border-radius: 8px; font-weight: bold; z-index: 10; }

        /* --- FOOTER --- */
        .brc-footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: #2d3748; color: white; padding: 10px 20px;
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.85rem; z-index: 200;
        }
    </style>
</head>
<body>

    <div class="hero">
        <h1>The S.A.G.E. Ethics Lab</h1>
        <p>Complete Diagnostic Toolkit: From Trolleys to Tensions</p>
    </div>

    <div class="nav-bar">
        <button class="nav-btn active" onclick="showSection('trolley-lab')">1. The Trolley Lab (Full)</button>
        <button class="nav-btn" onclick="showSection('chapter3')">2. Real World Case</button>
        <button class="nav-btn" onclick="showSection('synthesis')">3. Triangulation</button>
    </div>

    <div class="container">

        <div id="trolley-lab" class="section active">
            
            <div style="text-align: center; margin-bottom: 20px;">
                <span style="font-weight:bold; color:#718096; text-transform:uppercase; font-size:0.9rem;">Select Scenario:</span><br>
                <button class="btn btn-outline" style="min-width:auto; padding:5px 10px; margin:5px;" onclick="loadScenario(1)">1. Classic</button>
                <button class="btn btn-outline" style="min-width:auto; padding:5px 10px; margin:5px;" onclick="loadScenario(2)">2. Fat Man</button>
                <button class="btn btn-outline" style="min-width:auto; padding:5px 10px; margin:5px;" onclick="loadScenario(3)">3. Loop</button>
                <button class="btn btn-outline" style="min-width:auto; padding:5px 10px; margin:5px; border-color:var(--care); color:var(--care);" onclick="loadScenario(4)">4. Care Twist</button>
            </div>

            <div class="card">
                <h2 id="scenario-title">Scenario 1: Classic Trolley</h2>
                <div class="concept-box" id="scenario-desc">
                    A runaway trolley is heading toward 5 workers. You can pull a lever to divert it to a side track where 1 worker stands.
                </div>

                <div class="track-stage">
                    <div class="track-line"></div>
                    
                    <div class="track-split" id="vis-split"></div>
                    <div class="track-loop" id="vis-loop"></div>
                    <div class="track-bridge" id="vis-bridge"></div>

                    <div class="trolley-icon" id="trolley">üöÉ</div>
                    
                    <div class="victim-group">üë∑üë∑üë∑üë∑üë∑</div>
                    <div class="victim-single" id="vis-single">üë∑</div> <div class="victim-bridge" id="vis-fatman">üë§</div> <div class="victim-single" id="vis-mom" style="filter: drop-shadow(0 0 5px gold); display:none;">‚ù§Ô∏è</div> </div>

                <div class="btn-group" id="action-buttons">
                    </div>

                <div id="analysis-output" class="analysis-box"></div>
            </div>
        </div>

        <div id="chapter3" class="section">
            <div class="card">
                <h2>Phase 2: The Nonprofit Diagnostic</h2>
                <div class="concept-box">
                    <strong>The Real World Case:</strong> Your nonprofit received a $500k grant. Staff are burning out (BRC failure).
                    <br><br>
                    <strong>Option A (Management):</strong> Hire Consultants to build long-term systems.
                    <br><strong>Option B (Staff):</strong> Hire More Staff for immediate relief.
                </div>
                
                <p>Use your instruments to analyze the tension.</p>
                <div class="btn-group">
                    <button class="btn btn-outline" onclick="revealDiag('kant')">Apply Kantian Lens</button>
                    <button class="btn btn-outline" onclick="revealDiag('util')">Apply Utilitarian Lens</button>
                </div>

                <div id="diag-kant" class="lens-card" style="display:none; border-left-color: #9c27b0; margin-top:20px;">
                    <strong>KANTIAN DIAGNOSIS (Dignity):</strong> Favors <strong>Option B (Staff)</strong>.
                    <br>Ignoring current staff suffering to build a future system treats people as "mere means." It violates the <em>Recognition of Worth</em> test.
                </div>
                <div id="diag-util" class="lens-card" style="display:none; border-left-color: #2196f3; margin-top:10px;">
                    <strong>UTILITARIAN DIAGNOSIS (Outcomes):</strong> Favors <strong>Option A (Consultants)</strong>.
                    <br>Systems build capacity to serve 2x more clients in 5 years. The welfare calculation favors the many future beneficiaries over the few current staff.
                </div>

                <div id="tension-box" style="display:none; margin-top:20px; background:#fff3cd; padding:15px; border-left:4px solid #ffc107; border-radius:4px;">
                    <strong>‚ö° PRODUCTIVE TENSION DETECTED.</strong>
                    <br>The frameworks disagree. This is not a failure; it is data. The system is forcing a trade-off between Dignity and Utility.
                    <br><strong>Third Option Required:</strong> Staff-Led Capacity Building.
                </div>
            </div>
        </div>

        <div id="synthesis" class="section">
            <div class="card">
                <h2>Phase 3: The Triangulation Protocol</h2>
                <p>We have a Third Option: <strong>"Staff-Led Capacity Building."</strong> But is it sustainable? We must run the final check: The Care Audit.</p>

                <div class="triangle-container">
                    <div class="triangle-point tp-kant">KANT (Dignity)</div>
                    <div class="center-solution">The Solution</div>
                    <div class="triangle-point tp-care">CARE (Relations)</div>
                    <div class="triangle-point tp-util">UTIL (Outcomes)</div>
                    
                    <svg style="position:absolute; width:100%; height:100%; z-index:0;">
                        <line x1="50%" y1="20" x2="10%" y2="180" style="stroke:#cbd5e0;stroke-width:2" />
                        <line x1="50%" y1="20" x2="90%" y2="180" style="stroke:#cbd5e0;stroke-width:2" />
                        <line x1="10%" y1="180" x2="90%" y2="180" style="stroke:#cbd5e0;stroke-width:2" />
                    </svg>
                </div>

                <h3>Run the Care Audit (Tronto's Criteria)</h3>
                
                <div style="display:flex; flex-direction:column; gap:10px;">
                    <div id="audit-1" class="lens-card" style="opacity:0.5; transition:0.3s;">
                        <strong>1. Attentiveness:</strong> Did we notice the pain?
                        <br><em style="color:var(--care)">Verdict: Yes. We acknowledged the burnout first.</em>
                    </div>
                    <div id="audit-2" class="lens-card" style="opacity:0.5; transition:0.3s;">
                        <strong>2. Competence:</strong> Is the care effective?
                        <br><em style="color:var(--care)">Verdict: Yes. Budget is allocated to actual relief, not just talk.</em>
                    </div>
                    <div id="audit-3" class="lens-card" style="opacity:0.5; transition:0.3s;">
                        <strong>3. Responsiveness:</strong> Does it strengthen the relationship?
                        <br><em style="color:var(--care)">Verdict: Yes. Staff author the changes, increasing solidarity.</em>
                    </div>
                </div>

                <button class="btn btn-care" style="margin-top:20px; width:100%;" onclick="runAudit()">VALIDATE SOLUTION</button>
                
                <div id="final-success" style="display:none; text-align:center; margin-top:20px; color:green; font-weight:bold;">
                    ‚úÖ SYSTEM STABLE. Solution satisfies Dignity, Utility, AND Care.
                </div>
            </div>
        </div>

    </div>

    <div class="brc-footer">
        <div style="display:flex; align-items:center; gap:10px;">
            <div style="width:10px; height:10px; border-radius:50%; background:#48bb78; box-shadow:0 0 5px #48bb78;"></div>
            <strong>Step Zero: BRC Defense</strong>
        </div>
        <div>Protect your biology (Sleep/Rest). Ethics requires energy.</div>
    </div>

    <script>
        // --- NAVIGATION ---
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            window.scrollTo(0,0);
        }

        // --- TROLLEY LOGIC ---
        const scenarios = {
            1: {
                title: "1. Classic Trolley",
                desc: "Runaway trolley. 5 workers on main track vs 1 on side track. Do you divert it?",
                visuals: ['vis-split', 'vis-single'],
                btnAction: "Pull Lever (Kill 1)",
                btnNeutral: "Do Nothing (Kill 5)",
                analysis: `
                    <div class="lens-card" style="border-left:4px solid #2196f3"><strong>Utilitarian:</strong> PULL. 5 > 1. Outcome maximizes life.</div>
                    <div class="lens-card" style="border-left:4px solid #9c27b0"><strong>Kantian:</strong> PERMISSIBLE. The death is a side-effect, not a means.</div>
                `
            },
            2: {
                title: "2. The Fat Man",
                desc: "Trolley heading for 5. You are on a bridge next to a large stranger. Pushing him will stop the train. Do you push?",
                visuals: ['vis-bridge', 'vis-fatman'],
                btnAction: "Push Stranger (Kill 1)",
                btnNeutral: "Do Nothing (Kill 5)",
                analysis: `
                    <div class="lens-card" style="border-left:4px solid #2196f3"><strong>Utilitarian:</strong> PUSH. 5 > 1. Same math as before.</div>
                    <div class="lens-card" style="border-left:4px solid #9c27b0"><strong>Kantian:</strong> FORBIDDEN. You are using his body as a "mere means." Dignity violation.</div>
                `
            },
            3: {
                title: "3. The Loop",
                desc: "Side track loops back to main. The 1 worker is heavy enough to stop the train. If you divert, his body stops it. Do you pull?",
                visuals: ['vis-loop', 'vis-single'],
                btnAction: "Pull Lever (Use Body)",
                btnNeutral: "Do Nothing (Kill 5)",
                analysis: `
                    <div class="lens-card" style="border-left:4px solid #2196f3"><strong>Utilitarian:</strong> PULL. 5 > 1.</div>
                    <div class="lens-card" style="border-left:4px solid #9c27b0"><strong>Kantian:</strong> PROBLEMATIC. Unlike classic, here the death IS the means.</div>
                `
            },
            4: {
                title: "4. The Care Twist",
                desc: "Classic setup (5 vs 1), BUT the 1 is your Mother/Partner. The math (5 > 1) hasn't changed. Have you?",
                visuals: ['vis-split', 'vis-mom'],
                btnAction: "Pull Lever (Kill Mom)",
                btnNeutral: "Do Nothing (Save Mom)",
                analysis: `
                    <div class="lens-card" style="border-left:4px solid #2196f3"><strong>Utilitarian:</strong> PULL. Your mom counts as 1. To save her is bias.</div>
                    <div class="lens-card" style="border-left:4px solid var(--care)"><strong>Care Ethics:</strong> SAVE MOM. You have a relational duty that overrides the math.</div>
                `
            }
        };

        let currentScen = 1;

        function loadScenario(n) {
            currentScen = n;
            const s = scenarios[n];
            
            // 1. Text Updates
            document.getElementById('scenario-title').innerText = s.title;
            document.getElementById('scenario-desc').innerText = s.desc;
            document.getElementById('analysis-output').style.display = 'none';

            // 2. Visual Reset
            ['vis-split', 'vis-loop', 'vis-bridge', 'vis-single', 'vis-fatman', 'vis-mom'].forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            document.getElementById('trolley').style.transform = "translate(0,0)";

            // 3. Enable Visuals for current scenario
            s.visuals.forEach(id => document.getElementById(id).style.display = 'block');

            // 4. Buttons
            const btns = document.getElementById('action-buttons');
            btns.innerHTML = `
                <button class="btn btn-action" onclick="runSim('action')">${s.btnAction}</button>
                <button class="btn btn-danger" onclick="runSim('neutral')">${s.btnNeutral}</button>
            `;
        }

        function runSim(choice) {
            const trolley = document.getElementById('trolley');
            const analysis = document.getElementById('analysis-output');
            
            // Animation logic based on scenario
            if (choice === 'action') {
                if(currentScen === 2) {
                    // Fat Man drops
                    document.getElementById('vis-fatman').style.top = "40%";
                    trolley.style.transform = "translate(100px, 0)"; // Stops at body
                } else {
                    // Divert
                    trolley.style.transform = "translate(50px, 80px) rotate(20deg)";
                }
            } else {
                // Do nothing: trolley goes straight
                trolley.style.transform = "translate(200px, 0)";
            }

            // Show Analysis
            analysis.innerHTML = scenarios[currentScen].analysis;
            setTimeout(() => {
                analysis.style.display = 'block';
                analysis.scrollIntoView({behavior:"smooth"});
            }, 600);
        }

        // --- CHAPTER 3 LOGIC ---
        let kReveal = false, uReveal = false;
        function revealDiag(type) {
            document.getElementById('diag-' + type).style.display = 'block';
            if(type === 'kant') kReveal = true;
            if(type === 'util') uReveal = true;
            if(kReveal && uReveal) document.getElementById('tension-box').style.display = 'block';
        }

        function runAudit() {
            document.getElementById('audit-1').style.opacity = '1';
            document.getElementById('audit-1').style.borderLeft = '4px solid var(--care)';
            
            setTimeout(() => {
                document.getElementById('audit-2').style.opacity = '1';
                document.getElementById('audit-2').style.borderLeft = '4px solid var(--care)';
            }, 400);

            setTimeout(() => {
                document.getElementById('audit-3').style.opacity = '1';
                document.getElementById('audit-3').style.borderLeft = '4px solid var(--care)';
                document.getElementById('final-success').style.display = 'block';
            }, 800);
        }

        // Init
        loadScenario(1);
    </script>
</body>
</html>
